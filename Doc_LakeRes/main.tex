%==============================================================================
% CONFIGURATION PRINCIPALE DU DOCUMENT
%==============================================================================
% Template pour documentation de thèse avec code
% Auteur original: Bastien Boivin
% Adapté comme template réutilisable
%==============================================================================

\documentclass[12pt,a4paper]{report} % Classe de base du document avec taille de police et format

%==============================================================================
% SECTION 1: PACKAGES DE BASE ET CONFIGURATION GÉNÉRALE
%==============================================================================

%------------------------------------------------------------------------------
% 1.1 ENCODAGE ET POLICES
%------------------------------------------------------------------------------
\usepackage[utf8]{inputenc}     % Prise en charge des caractères accentués
\usepackage[T1]{fontenc}        % Encodage des polices pour support des caractères français
\usepackage[french]{babel}      % Support de la langue française
\usepackage{lmodern}            % Police Latin Modern (amélioration de Computer Modern)
\usepackage{microtype}          % Améliorations typographiques fines
\usepackage{tgheros}            % Police sans-serif moderne (TeX Gyre Heros)

%------------------------------------------------------------------------------
% 1.2 MISE EN PAGE ET GRAPHIQUES
%------------------------------------------------------------------------------
\usepackage{graphicx}           % Insertion d'images
\usepackage{tikz}               % Dessin vectoriel
\usetikzlibrary{calc}           % Extensions de calcul pour TikZ
\usepackage{float}              % Meilleur contrôle du positionnement des flottants (figure, table)
\usepackage{fontawesome5}       % Icônes vectorielles

%------------------------------------------------------------------------------
% 1.3 GESTION DES AVERTISSEMENTS
%------------------------------------------------------------------------------
\usepackage{silence}            % Permet de désactiver certains avertissements
\WarningFilter{minitoc(hints)}{The titlesec package is loaded}
\WarningFilter{minitoc(hints)}{Some hints have been written}

%------------------------------------------------------------------------------
% 1.4 TABLES DES MATIÈRES
%------------------------------------------------------------------------------
\usepackage{minitoc}            % Tables des matières par chapitre
\setcounter{minitocdepth}{2}    % Profondeur (jusqu'aux sous-sections)
\setlength{\mtcindent}{0pt}     % Pas d'indentation pour les mini-TOC
\renewcommand{\mtcfont}{\small\rmfamily}       % Police mini-TOC
\renewcommand{\mtcSfont}{\small\rmfamily}      % Police titres mini-TOC

%------------------------------------------------------------------------------
% 1.5 MARGES
%------------------------------------------------------------------------------
\usepackage[a4paper,top=2.5cm,bottom=2.5cm,left=2cm,right=2cm]{geometry}

%==============================================================================
% SECTION 2: FORMATAGE ET STYLES DU DOCUMENT
%==============================================================================

%------------------------------------------------------------------------------
% 2.1 STYLE DES CHAPITRES
%------------------------------------------------------------------------------
\usepackage{titlesec}           % Personnalisation des titres
% Format visuel des chapitres avec règles horizontales
\titleformat{\chapter}[display]
  {\bfseries\Huge\centering}
  {\rule{\textwidth}{1pt}\\\vspace{1cm}
   \Huge Chapitre \thechapter}
  {1cm}
  {\Huge}
  [\vspace{1cm}\rule{\textwidth}{1pt}]

%------------------------------------------------------------------------------
% 2.2 EN-TÊTES ET PIEDS DE PAGE
%------------------------------------------------------------------------------
\usepackage{xcolor}             % Gestion des couleurs
\usepackage{fancyhdr}           % En-têtes et pieds de page personnalisés
\pagestyle{fancy}
\fancyhf{}                      % Réinitialise tous les champs d'en-tête/pied de page
\setlength{\headheight}{14.9pt} % Hauteur d'en-tête minimale requise

% Personnalisation des en-têtes
\fancyhead[L]{\textcolor{gray}{Bastien Boivin}}     % À MODIFIER: Nom de l'auteur
\fancyhead[R]{\textcolor{gray}{Suivi de Thèse}}     % À MODIFIER: Titre court

% Personnalisation des pieds de page
\fancyfoot[L]{\textcolor{gray}{Brouillon}}          % À MODIFIER: Statut du document
\fancyfoot[R]{\textcolor{gray}{2025}}               % À MODIFIER: Année
\fancyfoot[C]{\thepage}                             % Numéro de page au centre

% Style des filets d'en-tête et pied de page
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\renewcommand{\headrule}{\color{gray}\hrule height \headrulewidth}
\renewcommand{\footrule}{\color{gray}\hrule height \footrulewidth}

%==============================================================================
% SECTION 3: STYLES POUR CODE ET ÉLÉMENTS TECHNIQUES
%==============================================================================

%------------------------------------------------------------------------------
% 3.1 PACKAGES POUR AFFICHAGE DE CODE
%------------------------------------------------------------------------------
\usepackage{listings}           % Affichage de code source
\usepackage{tcolorbox}          % Boîtes colorées avancées
\tcbuselibrary{listings,skins,breakable}   % Extensions de tcolorbox

%------------------------------------------------------------------------------
% 3.2 DÉFINITION DES COULEURS
%------------------------------------------------------------------------------
% Couleurs pour l'affichage du code (inspiré du thème Github Dark)
\definecolor{gdbg}{HTML}{0D1117}         % Arrière-plan
\definecolor{gdfg}{HTML}{C9D1D9}         % Texte standard
\definecolor{gdcomment}{HTML}{8B949E}    % Commentaires
\definecolor{kdkeyword}{HTML}{FF7B72}    % Mots-clés
\definecolor{gdstring}{HTML}{A5D6FF}     % Chaînes
\definecolor{gdidentifier}{HTML}{7DD7A6} % Identificateurs
\definecolor{gdself}{HTML}{D2B48C}       % self (Python)

% Couleurs pour code en ligne
\definecolor{inlineCodeBg}{HTML}{F3F4F6} % Fond du code en ligne
\definecolor{inlineCodeText}{HTML}{c9832b} % Texte du code en ligne

%------------------------------------------------------------------------------
% 3.3 STYLE DE CODE PYTHON
%------------------------------------------------------------------------------
\lstdefinestyle{githubdark}{%
  language=Python,
  backgroundcolor=\color{gdbg},
  basicstyle=\ttfamily\small\color{gdfg},
  keywordstyle=\color{kdkeyword}\bfseries,
  commentstyle=\color{gdcomment}\itshape,
  stringstyle=\color{gdstring},
  identifierstyle=\color{gdidentifier},
  emph={self},emphstyle=\color{gdself}\bfseries,
  showstringspaces=false,
  numbers=left,numberstyle=\tiny\color{gdcomment},numbersep=12pt,
  breaklines=true,frame=none,captionpos=b,tabsize=4,
  inputencoding=utf8,extendedchars=true,
  literate={é}{{\'e}}1 {è}{{\`e}}1 {ê}{{\^e}}1 {à}{{\`a}}1 {ç}{{\c{c}}}1
}

% Configuration du bloc de code Python avec tcolorbox
\tcbset{
  pythonlisting/.style={enhanced,breakable,arc=4pt,boxrule=0pt,
    colback=gdbg,colframe=gdbg,left=4pt,right=4pt,top=4pt,bottom=4pt,
    listing only,listing options={style=githubdark},
  }
}

\newtcblisting{pythoncode}[1][]{pythonlisting,title=#1}

%------------------------------------------------------------------------------
% 3.4 CODE EN LIGNE
%------------------------------------------------------------------------------
% Définition du style pour le code en ligne
\lstdefinestyle{inlinestyle}{
  basicstyle=\ttfamily\small,
  backgroundcolor=\color{inlineCodeBg},
  breaklines=true,
  keepspaces=true,
  columns=flexible,
  showstringspaces=false,
  showspaces=false
}

% Configuration de lstinline pour qu'il utilise notre style
\lstset{style=inlinestyle}

% Commande pour du code en ligne avec formatage consistant
\newcommand{\inlinecode}[1]{%
  \colorbox{inlineCodeBg}{%
    \lstinline[basicstyle=\ttfamily\small\color{inlineCodeText}]!#1!%
  }%
}

%------------------------------------------------------------------------------
% 3.5 STYLES POUR CHEMINS DE FICHIERS
%------------------------------------------------------------------------------
% Définition des couleurs pour les chemins de fichiers
\definecolor{pathBg}{HTML}{F3F4F6}      % Fond gris très clair
\definecolor{pathBorder}{HTML}{E5E7EB}  % Bordure grise claire
\definecolor{pathText}{HTML}{374151}    % Texte gris foncé
\definecolor{folderColor}{HTML}{4B5563} % Couleur de l'icône de dossier

% Chemin de fichier simple
\newcommand{\filepath}[1]{%
  \colorbox{pathBg}{%
    \lstinline[basicstyle=\ttfamily\small\color{pathText}]!#1!%
  }%
}

% Chemin avec icône de dossier
\definecolor{folderIconBg}{HTML}{F3F4F6} % Même couleur que le fond
\newcommand{\folderpath}[1]{%
  \colorbox{pathBg}{%
    \textcolor{folderColor}{\faFolder}\,%
    \lstinline[basicstyle=\ttfamily\small\color{pathText}]!#1!%
  }%
}

% Chemin URL
\definecolor{urlBg}{HTML}{F0F9FF}       % Fond bleu très clair
\definecolor{urlText}{HTML}{0369A1}     % Texte bleu foncé
\definecolor{linkColor}{HTML}{0284C7}   % Couleur de l'icône de lien

\newcommand{\urlpath}[1]{%
  \colorbox{urlBg}{%
    \textcolor{linkColor}{\faLink}\,%
    \lstinline[basicstyle=\ttfamily\small\color{urlText}]!#1!%
  }%
}

%==============================================================================
% SECTION 4: HYPERLIENS ET RÉFÉRENCES
%==============================================================================

\usepackage[hidelinks,colorlinks=true,linkcolor=black,citecolor=black,urlcolor=blue]{hyperref}
\usepackage{bookmark}           % Améliorations des signets PDF

% Configuration pour que les liens multi-lignes apparaissent comme un seul bloc
\usepackage{etoolbox}
\makeatletter
\patchcmd{\hyper@makecurrent}
  {\let\Hy@temp=}
  {\let\Hy@temp=\@firstofone}
  {}{}
\makeatother

%==============================================================================
% SECTION 5: TABLEAUX ET FIGURES
%==============================================================================

%------------------------------------------------------------------------------
% 5.1 PACKAGES POUR TABLEAUX AMÉLIORÉS
%------------------------------------------------------------------------------
\usepackage{booktabs,array}     % Tableaux professionnels avec règles horizontales améliorées
\usepackage{siunitx}            % Formatage cohérent des unités et nombres
\renewcommand{\arraystretch}{1.2}\setlength{\tabcolsep}{8pt}  % Espacement des tableaux
\sisetup{detect-family,table-number-alignment=center,
  table-figures-integer=3,table-figures-decimal=2,
  output-decimal-marker=.,exponent-mode=fixed}

%------------------------------------------------------------------------------
% 5.2 CONFIGURATION DES LÉGENDES
%------------------------------------------------------------------------------
\usepackage{caption}            % Personnalisation des légendes
\usepackage{subcaption}         % Pour les sous-figures
\DeclareCaptionFont{figcaption}{\small\sffamily}
\DeclareCaptionFont{figlabel}{\bfseries\sffamily}

% Style pour légendes de figures
\captionsetup[figure]{
    format=hang,
    font=figcaption,
    labelfont=figlabel,
    labelsep=quad,
    justification=raggedright,
    singlelinecheck=true,
    skip=10pt
}

% Style pour légendes de tableaux
\captionsetup[table]{
    format=hang,
    font=figcaption,
    labelfont=figlabel,
    labelsep=quad,
    justification=centering,
    singlelinecheck=true,
    skip=5pt
}

% Style pour sous-figures
\captionsetup[subfigure]{
    format=hang,
    font=figcaption,
    labelfont=figlabel,
    labelsep=space,
    justification=centering,
    singlelinecheck=true,
    skip=5pt
}

% Style pour listes de figures et tableaux
\renewcommand{\listfigurename}{Liste des figures}
\renewcommand{\listtablename}{Liste des tableaux}

%------------------------------------------------------------------------------
% 5.3 COMMANDES PERSONNALISÉES POUR FIGURES
%------------------------------------------------------------------------------
% Environnement pour figures centrées avec légende
\newcommand{\centeredfigure}[3][1.0]{%
    \begin{center}
        \includegraphics[width=#1\textwidth]{#2}
        \captionof{figure}{#3}
        \label{fig:#2}
    \end{center}
}

%==============================================================================
% SECTION 6: CALLOUTS (BOÎTES D'INFORMATION)
%==============================================================================

%------------------------------------------------------------------------------
% 6.1 DÉFINITION DES COULEURS
%------------------------------------------------------------------------------
% Couleurs pastel pour les différents types de callouts
\definecolor{infoBlue}{HTML}{81B0FB}      % Bleu pastel
\definecolor{tipGreen}{HTML}{92D3A2}      % Vert pastel
\definecolor{warnOrange}{HTML}{FFD970}    % Orange pastel
\definecolor{impRed}{HTML}{F7A7B0}        % Rouge pastel

%------------------------------------------------------------------------------
% 6.2 STYLE COMMUN POUR LES CALLOUTS
%------------------------------------------------------------------------------
\tcbset{
    callout/.style={
        enhanced,
        breakable,
        boxrule=0pt,
        colback=white,
        colframe=white,
        toprule=0pt,
        bottomrule=0pt,
        rightrule=0pt,
        leftrule=0pt,
        left=25pt,          % Marge interne à gauche
        right=5pt,
        top=5pt,
        bottom=5pt,
        before skip=8pt,
        after skip=8pt,
        % Décalage (tabulation) de la boîte entière
        left skip=1.5cm,    % Décalage à gauche
        right skip=1.5cm,   % Décalage à droite (pour équilibrer)
    }
}

%------------------------------------------------------------------------------
% 6.3 TYPES DE BOÎTES SPÉCIFIQUES
%------------------------------------------------------------------------------
% Boîte d'information (bleue)
\newtcolorbox{InfoBox}{%
  callout,
  borderline west={3pt}{3pt}{infoBlue},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=infoBlue] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faInfoCircle};
  }
}

% Boîte de conseil/astuce (verte)
\newtcolorbox{TipBox}{%
  callout,
  borderline west={3pt}{3pt}{tipGreen},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=tipGreen] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faLightbulb};
  }
}

% Boîte d'avertissement (orange)
\newtcolorbox{WarningBox}{%
  callout,
  borderline west={3pt}{3pt}{warnOrange},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=warnOrange] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faExclamationTriangle};
  }
}

% Boîte pour notes importantes (rouge)
\newtcolorbox{ImportantBox}{%
  callout,
  borderline west={3pt}{3pt}{impRed},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=impRed] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faExclamationCircle};
  }
}

%==============================================================================
% DÉBUT DU DOCUMENT
%==============================================================================

\begin{document}

\dominitoc % Activation des mini-TOC pour chaque chapitre

%------------------------------------------------------------------------------
% PAGE DE GARDE
%------------------------------------------------------------------------------
\input{sections/page_de_garde.tex}

%------------------------------------------------------------------------------
% FRONT MATTER: TABLES DES MATIÈRES, LISTES, ETC.
%------------------------------------------------------------------------------
\tableofcontents
\listoffigures
\listoftables

%------------------------------------------------------------------------------
% STYLE DE PAGE POUR LE CONTENU PRINCIPAL
%------------------------------------------------------------------------------
\pagestyle{fancy}

%------------------------------------------------------------------------------
% CONTENU PRINCIPAL DU DOCUMENT
%------------------------------------------------------------------------------
\input{sections/introduction.tex}

%------------------------------------------------------------------------------
% EXEMPLE DE TABLEAU
%------------------------------------------------------------------------------
\begin{table}[H]
  \centering
  \caption{Mesures de conductivité électrique}
  \label{tab:conductivite}
  \begin{tabular}{l S[table-format=2.1] S[table-format=3.2]}
    \toprule
    {Échantillon} & {Temp. (\si{\celsius})} & {Conductivité (\si{\siemens\per\meter})} \\
    \midrule
    A & 20.0 & 12.34 \\
    B & 25.5 & 13.02 \\
    C & 30.2 & 14.87 \\
    D & 35.0 & 16.45 \\
    \addlinespace
    \multicolumn{2}{l}{\textbf{Moyenne}} & 14.17 \\
    \bottomrule
  \end{tabular}
\end{table}

%------------------------------------------------------------------------------
% EXEMPLE DE FIGURE SIMPLE
%------------------------------------------------------------------------------
\begin{figure}[htbp] 
    \centering
    \includegraphics[width=0.7\textwidth]{figures/logos/Logo_Univ_Rennes.png}
    \caption{Logo de l'Université de Rennes avec une légende longue pour démontrer le formatage des légendes sur plusieurs lignes. Notez l'alignement et l'espacement.}
    \label{fig:logo_rennes}
\end{figure}

%------------------------------------------------------------------------------
% EXEMPLE DE FIGURE AVEC SOUS-FIGURES
%------------------------------------------------------------------------------
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/logos/Logo_EBR.png}
        \caption{Logo Eau du Bassin Rennais}
        \label{fig:logo_ebr}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/logos/Logo_Fondation_Rennes.png}
        \caption{Logo Fondation Rennes}
        \label{fig:logo_fondation}
    \end{subfigure}
    \caption{Logos des partenaires du projet de recherche}
    \label{fig:logos_partenaires}
\end{figure}

%------------------------------------------------------------------------------
% EXEMPLE D'UTILISATION DE LA COMMANDE CENTEREDFIGURE
%------------------------------------------------------------------------------
\begin{figure}[htbp]
    \centeredfigure[0.5]{figures/logos/Logo_Univ_Rennes.png}{Utilisation de la commande personnalisée \texttt{centeredfigure} pour insérer facilement une figure.}
\end{figure}

%------------------------------------------------------------------------------
% EXEMPLES DE CODE EN LIGNE
%------------------------------------------------------------------------------
Vous pouvez facilement intégrer du code en ligne comme \inlinecode{print("Bonjour")} ou 
\inlinecode{def fonction(x, y)} dans votre texte. Cette commande gère correctement les caractères 
spéciaux comme les underscores: \inlinecode{data_frame.apply(lambda x: x*2)}

Voici du texte normal pour montrer la différence de décalage entre 
le texte principal et les callouts qui suivent.

%------------------------------------------------------------------------------
% EXEMPLES DE CALLOUTS
%------------------------------------------------------------------------------
\begin{InfoBox}
Pour exécuter le script entier, naviguez vers \folderpath{scripts/analyse/} puis lancez \filepath{./run.sh}.
\end{InfoBox}

Retour au texte normal qui n'est pas décalé. Vous pouvez référencer la Figure~\ref{fig:logo_rennes} ou le Tableau~\ref{tab:conductivite}. 
Pour en savoir plus, consultez la documentation en ligne à \urlpath{https://texdoc.org/}.

\begin{TipBox}
Astuce : pensez à compiler avec \filepath{latexmk -pdf -silent main.tex}.
\end{TipBox}

\begin{WarningBox}
Attention : la fonction \inlinecode{analyse_avancee()} est expérimentale, vérifiez le log dans \folderpath{/var/log/analyse/}.
\end{WarningBox}

\begin{ImportantBox}
Important : sauvegardez toujours votre travail dans \folderpath{/home/user/backup/} avant toute reconfiguration.
\end{ImportantBox}

\end{document}