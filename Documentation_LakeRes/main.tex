% Document principal de suivi de thèse et documentation de code
\documentclass[12pt,a4paper]{report}

% ═════════════════════════════════════════════════════════════════
% ═══════════════ PACKAGES DE BASE ET CONFIGURATION ═══════════════
% ═════════════════════════════════════════════════════════════════

% ---------- ENCODAGE ET POLICE ----------
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{lmodern}
\usepackage{microtype}
\usepackage{tgheros}     % Police sans-serif moderne

% ---------- MISE EN PAGE ET GRAPHIQUES ----------
\usepackage{graphicx}
\usepackage{tikz}
\usetikzlibrary{calc}
\usepackage{float}        % option [H] pour tableaux et figures
\usepackage{fontawesome5} % icônes pour les callouts

% ---------- SILENCE DES AVERTISSEMENTS DE LATEX ----------
\usepackage{silence}
\WarningFilter{minitoc(hints)}{The titlesec package is loaded}
\WarningFilter{minitoc(hints)}{Some hints have been written}

% ---------- MINI-TABLES DES MATIÈRES ----------
\usepackage{minitoc}
\setcounter{minitocdepth}{2}
\setlength{\mtcindent}{0pt}
\renewcommand{\mtcfont}{\small\rmfamily}
\renewcommand{\mtcSfont}{\small\rmfamily}

% ---------- MARGES ----------
\usepackage[a4paper,top=2.5cm,bottom=2.5cm,left=2cm,right=2cm]{geometry}

% ═════════════════════════════════════════════════════════════════
% ═══════════════ FORMATAGE ET STYLES DU DOCUMENT ════════════════
% ═════════════════════════════════════════════════════════════════

% ---------- STYLE DES CHAPITRES ----------
\usepackage{titlesec}
\titleformat{\chapter}[display]
  {\bfseries\Huge\centering}
  {\rule{\textwidth}{1pt}\\\vspace{1cm}
   \Huge Chapitre \thechapter}
  {1cm}
  {\Huge}
  [\vspace{1cm}\rule{\textwidth}{1pt}]

% ---------- EN-TÊTES ET PIEDS DE PAGE ----------
\usepackage{xcolor}
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\setlength{\headheight}{14.9pt}
\fancyhead[L]{\textcolor{gray}{Bastien Boivin}}
\fancyhead[R]{\textcolor{gray}{Suivi de Thèse}}
\fancyfoot[L]{\textcolor{gray}{Brouillon}}
\fancyfoot[R]{\textcolor{gray}{2025}}
\fancyfoot[C]{\thepage}
\renewcommand{\headrulewidth}{0.4pt}
\renewcommand{\footrulewidth}{0.4pt}
\renewcommand{\headrule}{\color{gray}\hrule height \headrulewidth}
\renewcommand{\footrule}{\color{gray}\hrule height \footrulewidth}

% ═════════════════════════════════════════════════════════════════
% ═══════════════ STYLES POUR CODE ET ÉLÉMENTS TECHNIQUES ════════
% ═════════════════════════════════════════════════════════════════

\usepackage{listings}
\usepackage{tcolorbox}
\tcbuselibrary{listings,skins,breakable}

% ---------- COULEURS POUR CODE ET ÉLÉMENTS TECHNIQUES ----------
\definecolor{gdbg}{HTML}{0D1117}         % Github background
\definecolor{gdfg}{HTML}{C9D1D9}         % Github foreground
\definecolor{gdcomment}{HTML}{8B949E}    % Commentaires
\definecolor{kdkeyword}{HTML}{FF7B72}    % Mots-clés
\definecolor{gdstring}{HTML}{A5D6FF}     % Chaînes
\definecolor{gdidentifier}{HTML}{7DD7A6} % Identificateurs
\definecolor{gdself}{HTML}{D2B48C}       % self (Python)
\definecolor{inlineCodeBg}{HTML}{F3F4F6} % Fond du code en ligne
\definecolor{inlineCodeText}{HTML}{c9832b} % Texte du code en ligne

% ---------- STYLE DE CODE PYTHON (GITHUB DARK) ----------
\lstdefinestyle{githubdark}{%
  language=Python,
  backgroundcolor=\color{gdbg},
  basicstyle=\ttfamily\small\color{gdfg},
  keywordstyle=\color{kdkeyword}\bfseries,
  commentstyle=\color{gdcomment}\itshape,
  stringstyle=\color{gdstring},
  identifierstyle=\color{gdidentifier},
  emph={self},emphstyle=\color{gdself}\bfseries,
  showstringspaces=false,
  numbers=left,numberstyle=\tiny\color{gdcomment},numbersep=6pt,
  breaklines=true,frame=none,captionpos=b,tabsize=4,
  inputencoding=utf8,extendedchars=true,
  literate={é}{{\'e}}1 {è}{{\`e}}1 {ê}{{\^e}}1 {à}{{\`a}}1 {ç}{{\c{c}}}1
}

\tcbset{
  pythonlisting/.style={enhanced,breakable,arc=4pt,boxrule=0pt,
    colback=gdbg,colframe=gdbg,left=4pt,right=4pt,top=4pt,bottom=4pt,
    listing only,listing options={style=githubdark},
  }
}

\newtcblisting{pythoncode}[1][]{pythonlisting,title=#1}

% ---------- CODE EN LIGNE AVEC LISTINGS ----------
% Définition du style pour le code en ligne
\lstdefinestyle{inlinestyle}{
  basicstyle=\ttfamily\small,
  backgroundcolor=\color{inlineCodeBg},
  breaklines=true,
  keepspaces=true,
  columns=flexible,
  showstringspaces=false,
  showspaces=false
}

% Configuration de lstinline pour qu'il utilise notre style
\lstset{style=inlinestyle}

% Une commande de raccourci qui entoure lstinline avec un petit cadre
\newcommand{\inlinecode}[1]{%
  \colorbox{inlineCodeBg}{%
    \lstinline[basicstyle=\ttfamily\small\color{inlineCodeText}]!#1!%
  }%
}

% ---------- STYLE POUR CHEMINS DE FICHIERS ----------
\definecolor{pathBg}{HTML}{F3F4F6}      % Fond gris très clair
\definecolor{pathBorder}{HTML}{E5E7EB}  % Bordure grise claire
\definecolor{pathText}{HTML}{374151}    % Texte gris foncé
\definecolor{folderColor}{HTML}{4B5563} % Couleur de l'icône de dossier

% Chemin de fichier simple
\newcommand{\filepath}[1]{%
  \colorbox{pathBg}{%
    \lstinline[basicstyle=\ttfamily\small\color{pathText}]!#1!%
  }%
}

% Chemin avec icône de dossier
\definecolor{folderIconBg}{HTML}{F3F4F6} % Même couleur que le fond
\newcommand{\folderpath}[1]{%
  \colorbox{pathBg}{%
    \textcolor{folderColor}{\faFolder}\,%
    \lstinline[basicstyle=\ttfamily\small\color{pathText}]!#1!%
  }%
}

% Chemin URL
\definecolor{urlBg}{HTML}{F0F9FF}       % Fond bleu très clair
\definecolor{urlText}{HTML}{0369A1}     % Texte bleu foncé
\definecolor{linkColor}{HTML}{0284C7}   % Couleur de l'icône de lien

\newcommand{\urlpath}[1]{%
  \colorbox{urlBg}{%
    \textcolor{linkColor}{\faLink}\,%
    \lstinline[basicstyle=\ttfamily\small\color{urlText}]!#1!%
  }%
}

% ═════════════════════════════════════════════════════════════════
% ═══════════════ HYPERLIENS ET RÉFÉRENCES ════════════════════════
% ═════════════════════════════════════════════════════════════════

\usepackage[hidelinks,colorlinks=true,linkcolor=black,citecolor=black,urlcolor=blue]{hyperref}
\usepackage{bookmark}

% Configuration pour que les liens multi-lignes apparaissent comme un seul bloc
\usepackage{etoolbox}
\makeatletter
\patchcmd{\hyper@makecurrent}
  {\let\Hy@temp=}
  {\let\Hy@temp=\@firstofone}
  {}{}
\makeatother

% ═════════════════════════════════════════════════════════════════
% ═══════════════ TABLEAUX ET FIGURES ═════════════════════════════
% ═════════════════════════════════════════════════════════════════

\usepackage{booktabs,array}
\usepackage{siunitx}
\renewcommand{\arraystretch}{1.2}\setlength{\tabcolsep}{8pt}
\sisetup{detect-family,table-number-alignment=center,
  table-figures-integer=3,table-figures-decimal=2,
  output-decimal-marker=.,exponent-mode=fixed}

% ---------- CONFIGURATION DES LÉGENDES ----------
\usepackage{caption}
\usepackage{subcaption}    % Pour les sous-figures
\DeclareCaptionFont{figcaption}{\small\sffamily}
\DeclareCaptionFont{figlabel}{\bfseries\sffamily}

% Style pour légendes de figures
\captionsetup[figure]{
    format=hang,
    font=figcaption,
    labelfont=figlabel,
    labelsep=quad,
    justification=raggedright,
    singlelinecheck=true,
    skip=10pt
}

% Style pour légendes de tableaux
\captionsetup[table]{
    format=hang,
    font=figcaption,
    labelfont=figlabel,
    labelsep=quad,
    justification=centering,
    singlelinecheck=true,
    skip=5pt
}

% Style pour sous-figures
\captionsetup[subfigure]{
    format=hang,
    font=figcaption,
    labelfont=figlabel,
    labelsep=space,
    justification=centering,
    singlelinecheck=true,
    skip=5pt
}

% Style pour listes de figures et tableaux
\renewcommand{\listfigurename}{Liste des figures}
\renewcommand{\listtablename}{Liste des tableaux}

% ---------- ENVIRONNEMENT POUR FIGURES CENTRÉES ----------
\newcommand{\centeredfigure}[3][1.0]{%
    \begin{center}
        \includegraphics[width=#1\textwidth]{#2}
        \captionof{figure}{#3}
        \label{fig:#2}
    \end{center}
}

% ═════════════════════════════════════════════════════════════════
% ═══════════════ CALLOUTS ════════════════════════════════════════
% ═════════════════════════════════════════════════════════════════

% ---------- DÉFINITION DES COULEURS PASTEL ----------
\definecolor{infoBlue}{HTML}{81B0FB}      % Bleu pastel
\definecolor{tipGreen}{HTML}{92D3A2}      % Vert pastel
\definecolor{warnOrange}{HTML}{FFD970}    % Orange pastel
\definecolor{impRed}{HTML}{F7A7B0}        % Rouge pastel

% ---------- STYLE COMMUN POUR TOUS LES CALLOUTS ----------
\tcbset{
    callout/.style={
        enhanced,
        breakable,
        boxrule=0pt,
        colback=white,
        colframe=white,
        toprule=0pt,
        bottomrule=0pt,
        rightrule=0pt,
        leftrule=0pt,
        left=25pt,          % Marge interne à gauche
        right=5pt,
        top=5pt,
        bottom=5pt,
        before skip=8pt,
        after skip=8pt,
        % Décalage (tabulation) de la boîte entière
        left skip=1.5cm,    % Décalage à gauche
        right skip=1.5cm,   % Décalage à droite (pour équilibrer)
    }
}

% ---------- BOÎTES DE TYPE INFO ----------
\newtcolorbox{InfoBox}{%
  callout,
  borderline west={3pt}{3pt}{infoBlue},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=infoBlue] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faInfoCircle};
  }
}

% ---------- BOÎTES DE TYPE CONSEIL ----------
\newtcolorbox{TipBox}{%
  callout,
  borderline west={3pt}{3pt}{tipGreen},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=tipGreen] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faLightbulb};
  }
}

% ---------- BOÎTES DE TYPE AVERTISSEMENT ----------
\newtcolorbox{WarningBox}{%
  callout,
  borderline west={3pt}{3pt}{warnOrange},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=warnOrange] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faExclamationTriangle};
  }
}

% ---------- BOÎTES DE TYPE IMPORTANT ----------
\newtcolorbox{ImportantBox}{%
  callout,
  borderline west={3pt}{3pt}{impRed},
  overlay unbroken and first={
    \node[anchor=north west, inner sep=0pt, text=impRed] 
      at ([xshift=7pt, yshift=-5pt]frame.north west) {\faExclamationCircle};
  }
}

% ═════════════════════════════════════════════════════════════════
% ═══════════════ DÉBUT DU DOCUMENT ═════════════════════════════
% ═════════════════════════════════════════════════════════════════

\begin{document}

\dominitoc % mini-TOC

% --- Page de garde ---
\input{sections/page_de_garde.tex}

% --- Table des matières générale ---
\tableofcontents

% --- Liste des figures et tableaux ---
\listoffigures
\listoftables

% --- Style fancyhdr pour la suite ---
\pagestyle{fancy}

% --- Contenu principal ---
\input{sections/introduction.tex}

% Exemple de tableau fixe
\begin{table}[H]
  \centering
  \caption{Mesures de conductivité électrique}
  \label{tab:conductivite}
  \begin{tabular}{l S[table-format=2.1] S[table-format=3.2]}
    \toprule
    {Échantillon} & {Temp. (\si{\celsius})} & {Conductivité (\si{\siemens\per\meter})} \\
    \midrule
    A & 20.0 & 12.34 \\
    B & 25.5 & 13.02 \\
    C & 30.2 & 14.87 \\
    D & 35.0 & 16.45 \\
    \addlinespace
    \multicolumn{2}{l}{\textbf{Moyenne}} & 14.17 \\
    \bottomrule
  \end{tabular}
\end{table}

% Exemple de figure simple
\begin{figure}[htbp] 
    \centering
    \includegraphics[width=0.7\textwidth]{figures/logos/Logo_Univ_Rennes.png}
    \caption{Logo de l'Université de Rennes avec une légende longue pour démontrer le formatage des légendes sur plusieurs lignes. Notez l'alignement et l'espacement.}
    \label{fig:logo_rennes}
\end{figure}

% Exemple de figure avec sous-figures
\begin{figure}[htbp]
    \centering
    \begin{subfigure}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/logos/Logo_EBR.png}
        \caption{Logo Eau du Bassin Rennais}
        \label{fig:logo_ebr}
    \end{subfigure}
    \hfill
    \begin{subfigure}[b]{0.45\textwidth}
        \centering
        \includegraphics[width=\textwidth]{figures/logos/Logo_Fondation_Rennes.png}
        \caption{Logo Fondation Rennes}
        \label{fig:logo_fondation}
    \end{subfigure}
    \caption{Logos des partenaires du projet de recherche}
    \label{fig:logos_partenaires}
\end{figure}

% Exemple d'utilisation de la commande centeredfigure
\begin{figure}[htbp]
    \centeredfigure[0.5]{figures/logos/Logo_Univ_Rennes.png}{Utilisation de la commande personnalisée \texttt{centeredfigure} pour insérer facilement une figure.}
\end{figure}

% Exemple d'utilisation du code en ligne
Vous pouvez facilement intégrer du code en ligne comme \inlinecode{print("Bonjour")} ou 
\inlinecode{def fonction(x, y)} dans votre texte. Cette commande gère correctement les caractères 
spéciaux comme les underscores: \inlinecode{data_frame.apply(lambda x: x*2)}

Voici du texte normal pour montrer la différence de décalage entre 
le texte principal et les callouts qui suivent.

% Exemples de callouts
\begin{InfoBox}
Pour exécuter le script entier, naviguez vers \folderpath{scripts/analyse/} puis lancez \filepath{./run.sh}.
\end{InfoBox}

Retour au texte normal qui n'est pas décalé. Vous pouvez référencer la Figure~\ref{fig:logo_rennes} ou le Tableau~\ref{tab:conductivite}. 
Pour en savoir plus, consultez la documentation en ligne à \urlpath{https://texdoc.org/}.

\begin{TipBox}
Astuce : pensez à compiler avec \filepath{latexmk -pdf -silent main.tex}.
\end{TipBox}

\begin{WarningBox}
Attention : la fonction \inlinecode{analyse_avancee()} est expérimentale, vérifiez le log dans \folderpath{/var/log/analyse/}.
\end{WarningBox}

\begin{ImportantBox}
Important : sauvegardez toujours votre travail dans \folderpath{/home/user/backup/} avant toute reconfiguration.
\end{ImportantBox}

\end{document}